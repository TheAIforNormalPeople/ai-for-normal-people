# n8n Fixes - January 10, 2025

## Character Count Removal Fix

### Problem
Claude was including character count metadata (like "(147 characters)") in social media posts, which was showing up in Bluesky and Twitter posts.

### Root Cause
Multiple nodes were getting text directly from Claude's response without cleaning it:
1. **Build Bluesky Body** node - Gets text from Claude directly
2. **Combine** node - Gets text from Claude directly  
3. **Clean Twitter Text** node - Wasn't removing character count patterns
4. **Clean Bluesky Text** node - Wasn't removing character count patterns (new node)

### Solution
Added regex pattern to remove character count metadata:
```javascript
postText = postText.replace(/\s*\(?\d+\s*(character|char|chars)\)?/gi, '');
```

### Files Fixed

1. **Twitter:**
   - `aiforhumans/n8n/code/CLEAN_TWITTER_TEXT_FIXED.js` - Added character count removal

2. **Bluesky:**
   - `aiforhumans/n8n/code/BUILD_BLUESKY_BODY_FIXED.js` - Added character count removal
   - `aiforhumans/n8n/code/COMBINE_BLUESKY_FIXED.js` - Added character count removal
   - `aiforhumans/n8n/code/CLEAN_BLUESKY_TEXT_FIXED.js` - Added character count removal (new node)

### Documentation
- `aiforhumans/n8n/docs/CHARACTER_COUNT_FIX.md` - Problem and solution overview
- `aiforhumans/n8n/docs/BUILD_BLUESKY_BODY_FIX.md` - Build Bluesky Body fix
- `aiforhumans/n8n/docs/COMBINE_BLUESKY_FIX.md` - Combine node fix
- `aiforhumans/n8n/docs/QUICK_FIX_CHARACTER_COUNT.md` - Quick fix guide

### Implementation Status
✅ Code fixed and documented
⏳ Needs to be applied in n8n workflow:
- [ ] Update "Build Bluesky Body" node
- [ ] Update "Combine" node  
- [ ] Update "Clean Twitter Text" node (if using)
- [ ] Add "Clean Bluesky Text" node (optional, recommended)

### Pattern Removed
The regex removes patterns like:
- `(147 characters)`
- `(150 chars)`
- `147 characters`
- `150 chars`
- `(147)`
- `147 chars`

Any variation of character count metadata that Claude might add.

---

## Twitter Clean Text Improvements

### Issue Fixed
Node name reference error: `$('Character Rotation')` should be `$('Select Character')`

### Solution
- Fixed node reference in code
- Added error handling for missing nodes
- Improved text cleaning logic

### File
- `aiforhumans/n8n/code/CLEAN_TWITTER_TEXT_FIXED.js`

---

## Notes

- All fixes are backward compatible - they clean text without breaking existing functionality
- Character count removal is applied FIRST in cleaning process (before other cleaning)
- Both Twitter and Bluesky now have consistent text cleaning
