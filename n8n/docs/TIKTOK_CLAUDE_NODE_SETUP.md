# TikTok Claude Node Setup

## Goal
Add Claude node to generate actual video script from `scriptPrompt` generated by "Generate TikTok Content" code node.

---

## Workflow Structure

```
Select Character ‚Üí Generate TikTok Content (Code) ‚Üí Generate TikTok Script (Claude) ‚Üí [Manual Video Creation]
```

---

## Step-by-Step Setup

### 1. Add HTTP Request Node

**Node Type:** HTTP Request  
**Node Name:** "Generate TikTok Script" (or similar)  
**Position:** After "Generate TikTok Content" node

---

### 2. Configure HTTP Request Node

#### Basic Settings

**Method:** `POST`  
**URL:** `https://api.anthropic.com/v1/messages`  
**Authentication:** Predefined Credential Type ‚Üí `anthropicApi`

---

#### Headers

**Add Header:**
- **Name:** `anthropic-version`
- **Value:** `2023-06-01`

---

#### Body (JSON)

**Content Type:** JSON  
**JSON Body:**

```json
{
  "model": "claude-sonnet-4-20250514",
  "max_tokens": 1000,
  "messages": [
    {
      "role": "user",
      "content": "={{ $('Generate TikTok Content').first().json.scriptPrompt }}"
    }
  ]
}
```

**Important:** Use n8n expression syntax with `={{ }}` to reference the scriptPrompt from "Generate TikTok Content" node.

---

## Full Configuration

### Node Settings

| Setting | Value |
|---------|-------|
| **Name** | `Generate TikTok Script` |
| **Method** | `POST` |
| **URL** | `https://api.anthropic.com/v1/messages` |
| **Authentication** | `Predefined Credential Type` ‚Üí `anthropicApi` |
| **Send Headers** | ‚úÖ Yes |
| **Send Body** | ‚úÖ Yes |
| **Body Content Type** | `JSON` |
| **Specify Body** | `JSON` |

---

### Headers

| Name | Value |
|------|-------|
| `anthropic-version` | `2023-06-01` |

---

### Body (JSON)

**Option 1: Direct Expression (Recommended)**

```json
{
  "model": "claude-sonnet-4-20250514",
  "max_tokens": 1000,
  "messages": [
    {
      "role": "user",
      "content": "={{ $('Generate TikTok Content').first().json.scriptPrompt }}"
    }
  ]
}
```

**Option 2: Using Input (if connected directly)**

If "Generate TikTok Script" is connected directly FROM "Generate TikTok Content", you can use `$input`:

```json
{
  "model": "claude-sonnet-4-20250514",
  "max_tokens": 1000,
  "messages": [
    {
      "role": "user",
      "content": "={{ $input.first().json.scriptPrompt }}"
    }
  ]
}
```

**Use Option 1 if nodes are not directly connected, Option 2 if they are.**

---

## Why These Settings?

### Model: `claude-sonnet-4-20250514`
- Same model used for Twitter/Bluesky
- Good balance of quality and cost
- Consistent across platforms

### Max Tokens: `1000`
- Video scripts are longer than social posts
- 60-second script = ~150-200 words = ~750-1000 tokens
- Leave room for Claude's response formatting

### Content: `scriptPrompt`
- Generated by "Generate TikTok Content" code node
- Includes character, episode info, requirements
- Ready to use directly with Claude

---

## Expected Output

Claude will return a response like:

```json
{
  "content": [
    {
      "type": "text",
      "text": "[Hook - 5 seconds]\nHey! Have you ever wondered how AI systems develop abilities they were never taught? That's exactly what happened with GPT-4...\n\n[Key Point 1 - 15 seconds]\nResearchers discovered that GPT-4 learned to code without any programming training...\n\n..."
    }
  ],
  "stop_reason": "end_turn",
  "model": "claude-sonnet-4-20250514",
  "usage": {
    "input_tokens": 250,
    "output_tokens": 850
  }
}
```

**To get the script text:**
- Access via: `$input.first().json.content[0].text`
- Or: `$('Generate TikTok Script').first().json.content[0].text`

---

## Connection Flow

### Option 1: Direct Connection (Recommended)

```
Generate TikTok Content ‚Üí Generate TikTok Script (Claude)
```

**Advantages:**
- Cleaner workflow
- Can use `$input.first().json.scriptPrompt`
- Data flows directly

### Option 2: Reference Node (Alternative)

```
Generate TikTok Content ‚îê
                        ‚îú‚îÄ‚Üí Generate TikTok Script (Claude)
Other Node ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Advantages:**
- Can reference from multiple places
- More flexible

**Use:** `$('Generate TikTok Content').first().json.scriptPrompt`

---

## Testing

### Step 1: Test Node Configuration

1. **Save node configuration**
2. **Run workflow** (or test execution)
3. **Check "Generate TikTok Script" node**
4. **Verify:**
   - ‚úÖ No errors
   - ‚úÖ Status: Success (green checkmark)
   - ‚úÖ Response received from Claude

### Step 2: Check Output

1. **Open "Generate TikTok Script" node output**
2. **Verify structure:**
   ```json
   {
     "content": [
       {
         "type": "text",
         "text": "[Script text here...]"
       }
     ]
   }
   ```

3. **Check script quality:**
   - ‚úÖ Includes hook (5 seconds)
   - ‚úÖ Includes key points (15 seconds each)
   - ‚úÖ Includes CTA (10 seconds)
   - ‚úÖ Total ~60 seconds
   - ‚úÖ Character voice matches

### Step 3: Use Script

**To get script text:**
- `$input.first().json.content[0].text` (if connected directly)
- `$('Generate TikTok Script').first().json.content[0].text` (if referencing)

---

## Troubleshooting

### Error: "Cannot find 'Generate TikTok Content' node"

**Problem:** Node name doesn't match exactly.

**Fix:**
- Check exact node name (case-sensitive!)
- Use: `$('Generate TikTok Content').first().json.scriptPrompt`
- Verify node exists in workflow

---

### Error: "scriptPrompt is undefined"

**Problem:** Field name doesn't match.

**Fix:**
- Check "Generate TikTok Content" node output
- Verify field is named `scriptPrompt` (exact spelling)
- Use correct field name in expression

---

### Error: "Authentication failed"

**Problem:** Anthropic API credentials not set.

**Fix:**
1. Check "Generate Tweet via Claude" node credentials
2. Copy credential name
3. Use same credential for "Generate TikTok Script"
4. Verify API key is valid

---

### Error: "Request failed" or "400 Bad Request"

**Problem:** Body format incorrect.

**Fix:**
- Check JSON body format (must be valid JSON)
- Verify `anthropic-version` header is set
- Check `model` name is correct
- Verify `messages` array format

---

### Script Too Short/Long

**Problem:** Max tokens not optimal.

**Fix:**
- Increase `max_tokens` if script is cut off (try 1500)
- Decrease `max_tokens` if script is too long (try 800)
- Adjust based on your needs

---

## Comparison with Other Claude Nodes

### Twitter Claude Node

```json
{
  "model": "claude-sonnet-4-20250514",
  "max_tokens": 300,
  "messages": [
    {
      "role": "user",
      "content": "={{ $('Select Character').first().json.characterPrompt + ' Episode title: ' + $('Select Character').first().json.episodeTitle + ' Episode description: ' + $('Select Character').first().json.episodeDescription }}"
    }
  ]
}
```

### Bluesky Claude Node

```json
{
  "model": "claude-sonnet-4-20250514",
  "max_tokens": 300,
  "messages": [
    {
      "role": "user",
      "content": "={{ $('Select Character').first().json.characterPrompt.replace(/tweet/g, 'Bluesky post').replace(/240 characters/g, '150 characters') + ' Episode title: ' + $('Select Character').first().json.episodeTitle + ' Episode description: ' + $('Select Character').first().json.episodeDescription }}"
    }
  ]
}
```

### TikTok Claude Node (This One)

```json
{
  "model": "claude-sonnet-4-20250514",
  "max_tokens": 1000,
  "messages": [
    {
      "role": "user",
      "content": "={{ $('Generate TikTok Content').first().json.scriptPrompt }}"
    }
  ]
}
```

**Key Differences:**
- **Max Tokens:** 1000 (vs 300 for social posts) - scripts are longer
- **Content:** Uses `scriptPrompt` from code node (vs `characterPrompt` from Select Character)
- **Format:** Simpler - just the prompt (already formatted by code node)

---

## Next Steps

After setting up Claude node:

1. ‚úÖ Test node (verify it works)
2. ‚úÖ Check output (verify script quality)
3. ‚úÖ Use script for video creation (copy from output)
4. ‚úÖ Create video (use script + description from code node)
5. ‚úÖ Post to TikTok (use description + hashtags from code node)

---

## Summary

**Quick Setup:**
1. Add HTTP Request node
2. Configure: POST ‚Üí `https://api.anthropic.com/v1/messages`
3. Authentication: `anthropicApi`
4. Header: `anthropic-version: 2023-06-01`
5. Body: Use `scriptPrompt` from "Generate TikTok Content" node
6. Max Tokens: 1000 (for longer scripts)
7. Test and use!

**Expression to Use:**
```
={{ $('Generate TikTok Content').first().json.scriptPrompt }}
```

Or if directly connected:
```
={{ $input.first().json.scriptPrompt }}
```

---

**That's it! Once configured, Claude will generate your video scripts automatically!** üé¨
