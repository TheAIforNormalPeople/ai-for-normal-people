{{ define "main" }}

<!-- DEBUG: Show what we're working with -->
<!-- Title: {{ .Title }} -->
<!-- Lower Title: {{ lower .Title }} -->
<!-- Data exists: {{ if .Site.Data.characters }}YES{{ else }}NO{{ end }} -->

{{ $charName := lower .Title }}
{{ $charName = replace $charName " " "-" }}
{{ $charData := index .Site.Data.characters $charName }}

<!-- CharData exists: {{ if $charData }}YES{{ else }}NO{{ end }} -->

{{ if $charData }}
<div class="container-narrow">
    <!-- Back to Characters Link -->
    <nav class="character-nav-back">
        <a href="/characters/">
            ← Back to Characters
        </a>
    </nav>
    
    <article class="character-profile">
        <!-- Character Header -->
        <header class="character-header">
            <div class="character-avatar" data-color="{{ $charData.color }}" style="--char-color: {{ $charData.color }};">
                {{ $charData.initial }}
            </div>
            
            <h1 class="character-name" data-color="{{ $charData.color }}" style="--char-color: {{ $charData.color }};">
                {{ $charData.full_name }}
            </h1>
            
            <div class="character-designation">
                DESIGNATION: {{ $charData.designation }} | STATUS: {{ upper $charData.status }}
            </div>
        </header>
        
        <!-- Main Info Section -->
        <div class="character-info">
            <!-- Personality -->
            <section class="character-section">
                <h2 data-color="{{ $charData.color }}" style="--char-color: {{ $charData.color }};">PROFILE</h2>
                <div class="info-grid" data-color="{{ $charData.color }}" data-rgb="{{ $charData.color_rgb }}" style="--char-color: {{ $charData.color }}; --char-color-rgb: {{ $charData.color_rgb }};">
                    <p><strong>ROLE:</strong> {{ $charData.role }}</p>
                    <p><strong>ARCHETYPE:</strong> {{ $charData.archetype }}</p>
                    <p>{{ $charData.personality }}</p>
                </div>
            </section>
            
            <!-- Stats -->
            {{ if $charData.stats }}
            <section class="character-section">
                <h2 data-color="{{ $charData.color }}" style="--char-color: {{ $charData.color }};">SYSTEM STATUS</h2>
                <div class="stats-display" data-color="{{ $charData.color }}" data-rgb="{{ $charData.color_rgb }}" style="--char-color: {{ $charData.color }}; --char-color-rgb: {{ $charData.color_rgb }};">
                    {{ range $key, $value := $charData.stats }}
                    <div class="stat-item">
                        <span>{{ $key }}:</span> 
                        <span class="stat-value" data-color="{{ $charData.color }}" style="--char-color: {{ $charData.color }};">{{ $value }}</span>
                    </div>
                    {{ end }}
                </div>
            </section>
            {{ end }}
            
            <!-- Strengths & Weaknesses -->
            <div class="traits-grid">
                {{ if $charData.strengths }}
                <section class="character-section">
                    <h3 data-color="{{ $charData.color }}" style="--char-color: {{ $charData.color }};">STRENGTHS</h3>
                    <ul>
                        {{ range $charData.strengths }}
                        <li>✓ {{ . }}</li>
                        {{ end }}
                    </ul>
                </section>
                {{ end }}
                
                {{ if $charData.weaknesses }}
                <section class="character-section">
                    <h3 data-color="{{ $charData.color }}" style="--char-color: {{ $charData.color }};">WEAKNESSES</h3>
                    <ul>
                        {{ range $charData.weaknesses }}
                        <li>✗ {{ . }}</li>
                        {{ end }}
                    </ul>
                </section>
                {{ end }}
            </div>
            
            <!-- Quirks -->
            {{ if $charData.quirks }}
            <section class="character-section">
                <h2 data-color="{{ $charData.color }}" style="--char-color: {{ $charData.color }};">BEHAVIORAL QUIRKS</h2>
                <ul>
                    {{ range $charData.quirks }}
                    <li>{{ . }}</li>
                    {{ end }}
                </ul>
            </section>
            {{ end }}
            
            <!-- Catchphrases -->
            {{ if $charData.catchphrases }}
            <section class="character-section">
                <h2 data-color="{{ $charData.color }}" style="--char-color: {{ $charData.color }};">COMMON PHRASES</h2>
                <div class="catchphrase-container" data-color="{{ $charData.color }}" data-rgb="{{ $charData.color_rgb }}" style="--char-color: {{ $charData.color }}; --char-color-rgb: {{ $charData.color_rgb }};">
                    {{ range $charData.catchphrases }}
                    <div class="catchphrase-item" data-color="{{ $charData.color }}" style="--char-color: {{ $charData.color }};">"{{ . }}"</div>
                    {{ end }}
                </div>
            </section>
            {{ end }}
            
            <!-- Backstory -->
            {{ if $charData.origin }}
            <section class="character-section">
                <h2 data-color="{{ $charData.color }}" style="--char-color: {{ $charData.color }};">ORIGIN</h2>
                <div class="origin-container" data-color="{{ $charData.color }}" data-rgb="{{ $charData.color_rgb }}" style="--char-color: {{ $charData.color }}; --char-color-rgb: {{ $charData.color_rgb }};">
                    <p>{{ $charData.origin }}</p>
                    <p><strong>Time in blog:</strong> {{ $charData.time_in_blog }}</p>
                    <p><strong>Motivation:</strong> {{ $charData.motivation }}</p>
                </div>
            </section>
            {{ end }}
            
            <!-- Episode Appearances -->
            {{ if $charData.primary_episodes }}
            <section class="character-section">
                <h2 data-color="{{ $charData.color }}" style="--char-color: {{ $charData.color }};">EPISODE APPEARANCES</h2>
                <div class="episodes-container" data-color="{{ $charData.color }}" data-rgb="{{ $charData.color_rgb }}" style="--char-color: {{ $charData.color }}; --char-color-rgb: {{ $charData.color_rgb }};">
                    <p>Featured in {{ len $charData.primary_episodes }} episode{{ if gt (len $charData.primary_episodes) 1 }}s{{ end }}:</p>
                    <div class="episodes-badges">
                        {{ range $charData.primary_episodes }}
                        <span class="episode-badge" data-color="{{ $charData.color }}" data-rgb="{{ $charData.color_rgb }}" style="--char-color: {{ $charData.color }}; --char-color-rgb: {{ $charData.color_rgb }};">
                            Episode {{ . }}
                        </span>
                        {{ end }}
                    </div>
                    <p>
                        <a href="/blog/" class="episode-link" data-color="{{ $charData.color }}" style="--char-color: {{ $charData.color }};">Browse all episodes →</a>
                    </p>
                </div>
            </section>
            {{ end }}
            
            <!-- Relationships -->
            {{ if $charData.relationships }}
            <section class="character-section">
                <h2 data-color="{{ $charData.color }}" style="--char-color: {{ $charData.color }};">RELATIONSHIPS</h2>
                <div class="relationships">
                    {{ range $name, $description := $charData.relationships }}
                    {{ $relatedCharName := lower $name }}
                    {{ $relatedCharName = replace $relatedCharName " " "-" }}
                    {{ $relatedCharData := index $.Site.Data.characters $relatedCharName }}
                    <div class="relationship-item" data-color="{{ $charData.color }}" data-rgb="{{ $charData.color_rgb }}" style="--char-color: {{ $charData.color }}; --char-color-rgb: {{ $charData.color_rgb }};">
                        <strong>
                            {{ if $relatedCharData }}
                            <a href="/characters/{{ $relatedCharName }}/" class="character-link" data-color="{{ $charData.color }}" style="--char-color: {{ $charData.color }};">{{ $name }}</a>:
                            {{ else }}
                            {{ $name }}:
                            {{ end }}
                        </strong> {{ $description }}
                    </div>
                    {{ end }}
                </div>
            </section>
            {{ end }}
            
        </div>
    </article>
</div>
{{ else }}
<div class="container-narrow">
    <h1>DEBUG: No character data found</h1>
    <p>Looking for: {{ $charName }}</p>
    <p>Available data files:</p>
    <ul>
        {{ range $key, $value := .Site.Data.characters }}
        <li>{{ $key }}</li>
        {{ end }}
    </ul>
</div>
{{ end }}

<style>
.character-profile h2 {
    margin-top: 2rem;
    margin-bottom: 1rem;
    font-size: 1.2rem;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.character-profile h3 {
    margin-bottom: 0.75rem;
    font-size: 1rem;
}

.character-profile ul {
    line-height: 1.8;
}
</style>
{{ end }}
